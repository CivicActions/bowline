#!/usr/bin/env bash

source $(dirname $0)/../lib/bowline/bowline

settingspath=$GIT_ROOT/docroot/sites/default

if [ ! -d "${settingspath}" ];then
  echo "Looks like Drupal isn't installed. Would you like to install it? [Y,n,7,8]"
  read drupal
  drupal="$(echo ${drupal} | tr 'A-Z' 'a-z')"
  [ "${drupal}" = "n" ] && exit 1

  # Install Drupal
  version="drupal-7"
  if [ "${drupal}" = "8" ];then
    version="drupal-8"
    composer require drush/drush:8.*
  fi
  drush dl --destination=/var/www $version
  [ -d "docroot" ] && mv -v docroot old-docroot
  mv -v drupal-* docroot
fi


if [ ! -f "${settingspath}/local.settings.php" ];then
  cp -v ${settingspath}/sample_bowline.local.settings.php ${settingspath}/local.settings.php
  echo "Docker created ${settingspath}/local.settings.php for sandbox."
  echo "Edit the file if it is not for a sandbox."
elif [ ! "$(grep settings.docker.php ${settingspath}/local.settings.php)" ]; then
  echo "Docker based local.settings.php file already exists. Initialization skipped."
else
  echo "A local.settings.php file already exists, but is not Docker based."
  echo "If you would like to convert to Docker, remove ${settingspath}/local.settings.php and re-run this command."
fi

echo -ne "Hint: If you would like to perform a fresh site install, run this:\n\tdrush si --sites-subdir=default\n\n"

exit 0
